{{ define "main" }}
<!-- Hero Section -->
<header class="bg-gray-100">
  {{ partial "progressive-image.html" (dict "context" . "src" .Params.MainImage "alt" .Title) }}
  <div class="container mx-auto px-4 py-12">
    <div class="prose max-w-none">
      {{ .Params.Introduction | markdownify }}
    </div>
  </div>
</header>
<main class="container mx-auto px-4">
  <!-- Main Content -->
  <section class="my-12 prose max-w-none">
    {{ .Content }}
  </section>
  <!-- 祭神 -->
  <section class="my-12">
    {{ partial "card-columns" .Params.Saijin }}
  </section>
  <!-- お知らせ -->
  {{ if .Params.News }}
  <section class="my-12">
    <h2 class="text-2xl font-bold mb-4">お知らせ</h2>
    <div class="bg-blue-50 border border-blue-200 text-blue-800 p-4 rounded">
      <div class="prose max-w-none">
        {{ .Params.News | markdownify }}
      </div>
    </div>
  </section>
  {{ end }}
  <!-- ブログ一覧 -->
  <section class="my-12">
    <div class="mb-6">
      {{ partial "blog-table" . }}
      {{ $blogPostCount := len (where .Site.RegularPages "Section" "!=" "") }}
      {{ if gt 0 $blogPostCount }}
      <div class="flex flex-wrap gap-2 text-sm mt-4">
        <a href="/blog" class="inline-block bg-gray-200 px-3 py-1 rounded">全記事<sub>{{ $blogPostCount }}</sub></a>
        {{ partial "site-tags" . }}
      </div>
      {{ end }}
    </div>
  </section>
  <!-- 境内案内 -->
  <section class="my-12">
    <h2 class="text-2xl font-bold mb-4">境内案内</h2>
    {{ if .Params.KeidaiImage }}
    <img class="mb-6 mx-auto" src="{{ .Params.KeidaiImage }}" alt="境内画像">
    {{ end }}
    <div class="prose max-w-none">
      {{ .Params.keidaiDescription | markdownify }}
    </div>
  </section>
  <!-- アクセス -->
  <section class="my-12">
    <h2 class="text-2xl font-bold mb-4">アクセス</h2>
    <div class="prose max-w-none mb-6">
      {{ .Params.access1 | markdownify }}
    </div>
    <iframe class="w-full h-[450px] mb-6" src="{{ .Site.Params.officeMapIframeUrl }}" frameborder="0"></iframe>
    <div class="prose max-w-none">
      {{ .Params.access2 | markdownify }}
    </div>
  </section>
  <!-- Netlify CMS Redirect Script -->
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>
</main>
{{ end }}
